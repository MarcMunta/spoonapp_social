<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>{% block title %}SpoonApp SOCIAL{% endblock %}</title>
  {% load static %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>

<body>
  <div class="topbar">
    <div class="app-title"><a href="{% url 'home' %}">SpoonApp SOCIAL</a></div>
    <div class="topbar-icons">
      <a href="{% url 'home' %}">üè†</a>
      {% if user.is_authenticated %}
      <a href="{% url 'feed' %}">‚ûï</a>
      {% endif %}
      <span>üí¨</span>
      <span>üç¥</span>
      <span>‚öôÔ∏è</span>
    </div>
    <div class="profile-icon">
      {% if user.is_authenticated %}
      {% if user.profile.profile_picture %}
      <a href="{% url 'profile' user.username %}">
        <img src="{{ user.profile.profile_picture.url }}" alt="Foto de perfil"
          style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">
      </a>
      {% else %}
      <a href="{% url 'profile' user.username %}">
        <img src="https://i.imgur.com/jNNT4LE.png" alt="Por defecto"
          style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">
      </a>
      {% endif %}
      {% else %}
      <a href="{% url 'home' %}">
        <img src="https://i.imgur.com/jNNT4LE.png" alt="Invitado"
          style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">
      </a>
      {% endif %}
    </div>

  </div>

  <div class="sidebar">
    <div class="menu-item">Streams</div>
    <div class="menu-item">Events</div>
    <div class="menu-item">Friends</div>
    <div class="menu-item">Memories</div>
    <div class="menu-item">Games</div>
    <div class="restaurants-section">
      <h3>Restaurants</h3>
      <div class="restaurant-item">Luigi's Kitchen - <a href="#">Go To Site</a></div>
      <div class="restaurant-item">Restaurant 2 - <a href="#">Go To Site</a></div>
      <div class="restaurant-item">Restaurant 3 - <a href="#">Go To Site</a></div>
      <div class="restaurant-item">Restaurant 4 - <a href="#">Go To Site</a></div>
      <button class="see-more">See More</button>
    </div>
  </div>

  <div class="main-content">
    {% block content %}{% endblock %}
  </div>

  <div class="rightbar">
    <div class="sponsored">
      <h3>Sponsored</h3>
      <div class="sponsored-item">
        <img src="https://via.placeholder.com/250" alt="Sponsored Image">
        <div>Pizza with Pepperoni<br>Lorem ipsum dolor sit amet. -30%</div>
      </div>
    </div>
    <div class="friends">
      <h3>Friends</h3>

      <div class="search-friends-container">
<input type="text" id="searchFriendInput" placeholder="Search users..." onkeyup="filterUsers()" />
        <ul id="searchResults"></ul>
      </div>

      {% if pending_requests %}
      {% for req in pending_requests %}
      <div class="friend-status">
        {{ req.from_user.username }}
        <span>
          <a href="{% url 'accept_friend_request' req.id %}">Accept</a> |
          <a href="{% url 'reject_friend_request' req.id %}">Remove</a>
        </span>
      </div>
      {% endfor %}
      {% else %}
      <div class="friend-status">No pending friend requests</div>
      {% endif %}
    </div>
  </div>


  <script>
  const allUsers = [
    {% for user in all_users %}
      { "username": "{{ user.username }}", "url": "{% url 'profile' user.username %}" }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  function filterUsers() {
    const input = document.getElementById('searchFriendInput').value.toLowerCase();
    const resultsList = document.getElementById('searchResults');
    resultsList.innerHTML = '';

    if (input.length === 0) return;

    const filtered = allUsers.filter(u => u.username.toLowerCase().includes(input)).slice(0, 5);

    filtered.forEach(user => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="${user.url}">${user.username}</a>`;
      resultsList.appendChild(li);
    });
  }
</script>

</body>

</html>
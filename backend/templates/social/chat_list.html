{% extends "social/base.html" %}

{% block title %}Messages{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Messages</h2>
    
    {% if chat_data %}
    <div class="list-group">
        {% for data in chat_data %}
        <a href="{% url 'chat_detail' data.chat.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-start">
            <div class="d-flex align-items-center">
                {% if data.other_user.profile.profile_picture %}
                <img src="{{ data.other_user.profile.profile_picture.url }}" alt="Profile" 
                     style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px;">
                {% else %}
                <img src="https://i.imgur.com/jNNT4LE.png" alt="Default" 
                     style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px;">
                {% endif %}
                
                <div>
                    <h6 class="mb-1">{{ data.other_user.username }}</h6>
                    {% if data.last_message %}
                    <p class="mb-1 text-muted">
                        {% if data.last_message.sender == user %}You: {% endif %}
                        {{ data.last_message.content|truncatechars:50 }}
                    </p>
                    <small class="text-muted">{{ data.last_message.sent_at|timesince }} ago</small>
                    {% else %}
                    <p class="mb-1 text-muted">No messages yet</p>
                    {% endif %}
                </div>
            </div>
            
            {% if data.unread_count > 0 %}
            <span class="badge bg-primary rounded-pill">{{ data.unread_count }}</span>
            {% endif %}
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center mt-5">
        <p class="text-muted">No conversations yet. Start chatting with your friends!</p>
    </div>
    {% endif %}
</div>
{% endblock %}
